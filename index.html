<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>RGB Light Control</title>
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
</head>

<style>
    .centered
    {
        position: fixed;
        top: 50%;
        left: 50%;
        /* bring your own prefixes */
        transform: translate(-50%, -50%);
        background-color: black;
    }
</style>

<body class="centered">
    <meta name="theme-color" content="#000000"/>
    <div id="picker"></div>
</body>

<script type="text/javascript">
    function calculate_picker_look()
    {
        var orientation = (screen.orientation || {}).type || screen.mozOrientation || screen.msOrientation;
        
        if (orientation === "landscape-primary" || orientation === "landscape-secondary") 
        {
            var width = window.innerWidth - 0.6 * window.innerWidth;
            return [width, "horizontal"];
        }
        else if (orientation === "portrait-primary" || orientation === "portrait-secondary")
        {
            var width = window.innerWidth - 0.15 * window.innerWidth;
            return [width, "vertical"];
        }
        else if (orientation === undefined)
        {
            return [undefined, undefined];
        }
    }
    
    var picker_look = calculate_picker_look();
    var colorPicker = new iro.ColorPicker("#picker",
    {
        width: picker_look[0],
        layoutDirection: picker_look[1],
        borderWidth: 2,
        borderColor: "#f0f0f0",
        wheelLightness: false, 
        margin: 50
    });

    colorPicker.on('input:end',
    function(color)
    {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/rgb", true);
        xhr.setRequestHeader('Content-Type', 'text/plain');
        xhr.send(color.rgbString);
    });

    window.addEventListener("orientationchange",
    function ()
    {
        var width_and_layout = calculate_picker_look()
        colorPicker.state.width = width_and_layout[0];
        colorPicker.state.layoutDirection = width_and_layout[1];
        colorPicker.forceUpdate();
    });
</script>
</html>