<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>RGB Light Control</title>
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
</head>

<style>
    .centered
    {
        position: fixed;
        top: 50%;
        left: 50%;
        /* bring your own prefixes */
        transform: translate(-50%, -50%);
        background-color: black;
    }
</style>

<body class="centered">
    <meta name="theme-color" content="#000000"/>
    <div id="picker"></div>
</body>

<script type="text/javascript">
    function calculate_picker_size()
    {
        var orientation = (screen.orientation || {}).type || screen.mozOrientation || screen.msOrientation;
        console.log(orientation);
        
        if (orientation === "landscape-primary" || orientation === "landscape-secondary") 
        {
            var size = window.innerHeight - 0.2 * window.innerHeight;
            return size;
        }
        else if (orientation === "portrait-primary" || orientation === "portrait-secondary")
        {
            var size = window.innerWidth - 0.2 * window.innerWidth;
            return size;
        }
        else if (orientation === undefined)
        {
            return undefined;
        }
    }

    var picker_size = calculate_picker_size();
    console.log(picker_size);

    var colorPicker = new iro.ColorPicker("#picker",
    {
        width: calculate_picker_size(),
        borderWidth: 2,
        borderColor: '#f0f0f0',
        wheelLightness: false, 
        margin: 50
    });

    colorPicker.on('input:end',
    function(color)
    {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "/rgb", true);
        xhr.setRequestHeader('Content-Type', 'text/plain');
        xhr.send(color.rgbString);
    });

    screen.addEventListener("orientationchange",
    function ()
    {
        colorPicker.resize(calculate_picker_size())
    });
</script>
</html>